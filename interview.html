<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css">
    <script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <title>Interview Simulation</title>
    <script type="text/javascript">
        var dojoConfig = {
            async: true,
            baseUrl: "./",
            tlmSiblingOfDojo: false,
            packages: [
                {name: "js",   location: "js"},
                {name: "util", location: "js/util"}
            ]
        };
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="js/mespeak/mespeak.js"></script>
    <script type="text/javascript">
        // This parses the HTML interface and fades out the loading screen.
        require(["dojo/parser", "dojo/promise/all", "dojo/_base/fx", "dojo/dom-style", "dojo/dom", "dijit/layout/ContentPane", "dijit/layout/BorderContainer", "dojo/domReady!"],
            function (parser, all, fx, domStyle, dom) {

            all([parser.parse()]).then(function (_results) {
                setTimeout(function () {
                    fx.fadeOut({
                        node: dom.byId("loadingOverlay"),
                        duration: 1000,
                        onEnd: function(node){
                            domStyle.set(node, 'display', 'none');
                        }
                    }).play();
                }, 500);
            });
        });
        // Starts the app
        require(["js/Interviewer", "js/ChatBox", "js/Timer", "js/Editor", "js/Endscreen", "dojo/dom", "dojo/io-query", "dojo/domReady!"],
            function (Interviewer, ChatBox, Timer, Editor, Endscreen, dom, ioQuery) {
            require(["js/media"], function (media) {
                media.load();
            });

            var queryString = document.location.search.substr(document.location.search[0] === "?" ? 1 : 0);
            var urlParams = ioQuery.queryToObject(queryString);

            var editor = new Editor({
                editor: "editor"
            }).placeAt(dom.byId("main-area"));

            var chat = new ChatBox({
                defaultTimeOut: 60 * 5000
            }).placeAt(dom.byId("chat-area"));

            var timer = new Timer({
                minutes: urlParams["duration"]
            }).placeAt(dom.byId("time-area"));

            var endscreen = new Endscreen();

            var interviewer = new Interviewer({
                textBox: chat,
                timer: timer,
                editor: editor,
                endscreen: endscreen
            });

            // These connections should be done by some kind of manager class
            editor.evaluateAnswer = function () {
                interviewer.evaluateAnswer.apply(interviewer, arguments)
            };

            editor.getQuestion = function () {
                return interviewer.getQuestion.call(interviewer);
            };

            interviewer.beginInterview();
        });
    </script>
</head>

<body class="claro">
    <div class="pageOverlay">
        <div id="loadingOverlay">
            <div class="loadingMessage">Loading....</div>
        </div>
    </div>
    <div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'sidebar', gutters:true, liveSplitters:true" id="borderContainer" style="height:100%; width=100%;">
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'top'">
            <div id="question-prompt" style='font-size: 18px;'>&nbsp;</div>
        </div>
        <div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="splitter:true, region:'right'" style="width: 300px;">
            <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'top'" id="time-area"></div>
            <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="splitter:true, region:'center'" id="chat-area"></div>
        </div>
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="splitter:true, region:'center'" id="main-area">
        </div>
    </div>
    <!-- ignore these -->
    <select id='audioSource' style="display:none;"></select>
    <audio></audio>
    <script type="text/javascript">
        meSpeak.loadConfig("js/mespeak/mespeak_config.json");
        meSpeak.loadVoice("js/mespeak/voices/en/en-us.json");
    </script>
</body>
</html>
